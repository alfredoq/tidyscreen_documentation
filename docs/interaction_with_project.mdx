---
sidebar_position: 3
---

import Link from '@docusaurus/Link';

# Running a TidyScreen project

A typical vHTS project is comprised by three main stages:

- Construction of a working chemical space;
- Molecular docking of selected candidates;
- Molecular dynamics simulatons on promising hits;

TidyScreen assists in the configuration and execution of each of these stages. The central strategy is based on the philosophy that **indexing and storing data in SQL databases** can be functional not only to the organization of each working stage, but also favors the natural interconnection between them.

## Construction of a working chemical space

The chemical space to be explored during a vHTS campaign can be constructed using diverse methodological approaches, each one particularly adapted to the research objectives. Some of the alternatives are:

    - Reading compounds from a custom file;
    - Filtering of commercially available compounds;
    - Construction of libraries from databases (such as [ChEMBL](https://www.ebi.ac.uk/chembl/));
    - Exploration of in-house compounds libraries;
    - Enumeration of synthetic chemical routes;
    - Etc...

### Reading compounds from a custom file

This is the most simple way of introducing one or more compounds into a TidyScreen project. As mentioned before, these compounds will be stored in the SQL database corresponding to the `chemspace` dimension. **Note:** When a file containing compounds is uploaded into TidyScreen, a copy of such file is stored in the *'chemspace/raw'* folder.

[This](/files/aliphatic_alcohols.csv) is a sample `.csv` file containing five aliphatic alcohols, and we can use it as and example to store the corresponding compounds into the `chemspace` database using the following script:

```python
...
## We will add compounds present in 'aliphatic_alcohols.csv' into the already existing 'test1' project

# Activate a project to perform actions
test1_proj = proj_mg.ActivateProject("test1")

# Once activated, initialize ChemSpace actions on the project
test1_proj_CS = proj_mg.ChemSpaceActions(test1_proj)

# Once the ChemSapce dimension is activated, load the compounds present as SMILES in the .csv file
test1_proj_CS.process_raw_cpds_file("$PATH_TO_FILE/aliphatic_alcohols.csv")
```

Different parsing options can be applied to the `.csv` file depending on the separator used, the existence of a header or compounds names. In order to let TidyScreen know how to process the file, when executing the script the first two lines will be printed to the terminal and serie of questions will be presented in order to guide the parsing process. The following responses should be provided:

`Header presence (y/n):` # in this sample file it indeed contains a header (SMILES,Name)

`Separator string:` # In this case ','

`Field number corresponding to SMILES:` # in this file '0'

`Presence of molecules names (y/n):` # in this case 'y'

`Field number corresponding to the Names:` # in this case '1'

Upon providing the requested information, all molecules corresponding to the SMILES present in the `.csv` file will be stored in a SQL table named after the provided file (i.e. 'aliphatic_alcohols') and saved into the '/processed_data/chemspace.db' database file of the `chemspace` domain. (See the <Link to="/docs/projects_structure" target="_blank" rel="noopener noreferrer">
  Projects folders structure
</Link> section)  

Once loaded, the table containing the compounds can be inspected or modified using different approaches, such as:

    - **Listing the tables** present in '/processed_data/chemspace.db' database file of the `chemspace` domain:

```python
...
test1_proj = proj_mg.ActivateProject("test1")

test1_proj_CS = proj_mg.ChemSpaceActions(test1_proj)

# Execute the listing method on the project ChemSpace object
test1_proj_CS.list_ligands_tables()
```

output:

```bash
Tables in database corresponding to project: 'test1':

aliphatic_alcohols # <- the table containing the loaded compounds

# At the moment only one table of compounds is present in the database.
# If more tables are loaded, they will appear in alpahbetical order in the output.
```

    - **Listing of compounds** present in a given table:

```python
...
test1_proj = proj_mg.ActivateProject("test1")

test1_proj_CS = proj_mg.ChemSpaceActions(test1_proj)

# List the compounds present in the 'aliphatic_alcohols' table.
test1_proj_CS.list_cpds_in_table("aliphatic_alcohols")
```

output

```bash
('CO', 'methanol')
('CCO', 'ethanol')
('CCCO', 'propanol')
('CCCCO', 'butanol')
('CCCCCO', 'pentanol')
A total of 5 molecules are present in table: 'aliphatic_alcohols'
```
   
    - Using dedicated tools to manage SQL databases:

        - Use <Link to="https://www.visidata.org/" target="_blank" rel="noopener noreferrer"> VISIDATA </Link> to explore `chemspace.db` in the terminal.

        - Use <Link to="https://sqlitebrowser.org/" target="_blank" rel="noopener noreferrer"> DB Browser </Link> to explore `chemspace.db` using a GUI.


    - **Deleting** a loaded table:

```python
...
test1_proj = proj_mg.ActivateProject("test1")

test1_proj_CS = proj_mg.ChemSpaceActions(test1_proj)

# The 'aliphatic_alcohols' can be removed from 'chemspace.db'.
test1_proj_CS.delete_cpds_table("aliphatic_alcohols")
```

### Filtering of commercially available compounds;

Under construction

### Construction of libraries from databases

Under construction

### Exploration of in-house compounds libraries

Under construction

### Enumeration of synthetic chemical routes

This approach to the exploration of a chemical is associated to the definition of the *type of chemistry* that is going to be applied in the research project, both virtually and experimentally. Thus this approach is characterized by the existence of a previous knowledge respect to the synthetic feasibility of the compounds to be explored, including the synthetic versatility of each reaction step that is programmed. Tipically, in this stage there is a close communication between the scientist performing the virtual studies and the organic chemist that is going to synthesize the proposed candidates.

Briefly, the focus of the strategy is centered on one or more synthetic route/s towards the desired candidates, which in turn is related to the type and number of reactants involved in each step of the whole synthetic workflow. Sometimes, upon discussion with organic chemists, even the reactants of a given reaction stage can be indeed obtained through specific synthetic protocols, which further expands the experimental network towards the compounds in study. Following this approach, a massive chemical space with synthetic feasibility can be constructed and afterwards explored.

In short, the wole process is organized as follows:

    - Input of reactants into TidyScreen
    - Definition of a chemical reaction to transform reactants
    - Execution of a chemical reaction pipelline and storage of products


#### Input of reactants into TidyScreen

Se previous section dealing with the database ingestion and/or .csv file reading.

#### Definition of a chemical reaction to transform reactants

Chemical reactions can be simulated *in silico* by using the [SMARTS](https://www.daylight.com/dayhtml/doc/theory/theory.smarts.html) reaction notation, which is implemented in the Python package [RDKit](https://www.rdkit.org/docs/RDKit_Book.html), a central component of TidyScreen.

When TidyScreen is first installed, a custom set of reactions are already provided as part of the default `reactions_database`. It should be noted that this `reactions_database` belongs to the installed TidyScreen package and is not project specific, granting the possibility of applying common sunthetic procedures (such as chemical protection, deprotection, ionizations, etc) on different projects. Available reactions can be listed by creating a `main_database` object and afterwards use the `list_available_single_reaction` method as follows:

```python
...
main_database = ts_cfg.MainDbConfigs()
main_database.list_available_single_reactions()
```
Upon execution of this script, the following output will be provided showing the built-in chemical reactions:

```bash
These are the rections available in the main database

1: Azide_from_alpha_aminoacid - [NX3;H2:1][CX4:2][CX3,H0:3]>>[N-]=[N+]=[NX2;H0:1][CX4:2][CX3,H0:3]
2: Acylation - [CX3:1](=[O:2])[OX2H,OX1-:3].[C:4][O]>>[C:1](=[O:2])[O:3][C:4]
3: CuAAC - [NX1-:1]=[NX2+:2]=[NX2:3].[CX2H1:4]#[CX2H0:5]>>[NX2+0:1]1=[NX2+0:2][N:3]-[C:4]=[C:5]1
4: A3Coupling - [N:1].[CX3H1:2](=[O:3])>>[N:1][C:2][C:4]#[C:5]
5: DIBAL - [CX3:1](=[O:2])[OX2H,OX1-:3]>>[CX3H1:1](=[O:2])
6: Thiolation - [CX3:1](=[O:2])[OX2H,OX1-:3]>>[CX4:1][SX2H]
...
```

As can be seen , each reaction contains a `reaction_id` associated to a `reaction_name` and `reaction_smarts`. 

New reaction types can be added to the default ones included in the default database by using the `add_single_reactions_from_file` method, which will read a `.csv` file containing the following information:

- Field_1: `reaction_name`
- Field_2: `reaction_smarts`
- Field_3: `user_name`

This is the [default .csv file](/files/default_reaction_types.csv) installed upon the initial installation.

It should be noted that sometimes the creation of a reaction SMARTS can be tricky in terms of unambiguosly matching the correct chemical groups leading to the desired reaction product. The user should check the correctness of the SMARTS notation to be included in the database, otherwise synthetic artifacts will be included in the working chemical space under construction. To aid in this process, the [SMARTS PLUS](https://smarts.plus/) is a very usefull web application to create, view and check SMARTS pattern and matching.

#### Execution of a chemical reaction pipelline and storage of products

Under construction

## Filtering of building blocks

Since the construction of working chemical space is closely related to the selection of specific building blocks involved in the above mentioned synthetic pathways, it is frequently requiered to search and filter commercially available reactants form databases such as [ZINC](https://zinc.docking.org/) or [Emolecules](https://search.emolecules.com/). In this respect, the filtering can be also performed by using [SMARTS](https://www.daylight.com/dayhtml/doc/theory/theory.smarts.html) notation, and also TidyScreen provides a set of custom filters used to match typical reactants. The list of available filters can be que queried as follows:

```python
from tidyscreen import config as ts_cfg
import tidyscreen_dbs

main_database = ts_cfg.MainDbConfigs()
main_database.list_available_chem_filter()

```

which will output the following:

```bash
1: Aminoacids - [NX3H2,NX4+H3][CX4H]([*])[CX3H0](=[OX1])[OX2H,OX1-]
2: Boron - B
3: Silicon - [Si]
4: Azide - N=[N+]=[N-]
5: Terminal_alkyne - C#[CH]
6: Deuterium - [2H]
...
```

A was the case for the chemical reactions, each chemical filter is identified by a `filter_id` followed by a `filter_name`and `filter_smarts`. The use of the filter in production is performed by spcifing the corresponding `filter_id` which is unique to each filter.

Also custom filters can be added to the default ones provided upon installation of TidyScreen. To perform this, the used should use the `add_chem_filters_from_file` , which will read a `csv` file containing the following information:

- Field_1: `filter_name`
- Field_2: `filter_smarts`
- Field_3: `user_name`

It should be noted that actions related to listing or adding chemical reactions and/or filters are associated to the `main_database`of TidyScreen and not restricted to a single project. A such, the new SMARTS added will be available for all projects managed by TidyScreen in the local computer.